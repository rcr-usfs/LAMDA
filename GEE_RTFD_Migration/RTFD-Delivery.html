<!DOCTYPE html>
<html>
    <head>
		<meta charset="utf-8" />
		    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        	<meta content="utf-8" http-equiv="encoding">
        	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	        <meta name="description" content="USDA Forest Service RTFD Viewer ">
	        <meta name="keywords" content="Landscape, Change, Forestry, USDA, Forest Service, Remote Sensing, Earth Engine">
	        <meta name="author" content="Ian Housman">

		    <title>RTFD Product Downloads</title>

		    <!-- Latest compiled and minified CSS -->
			<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

			<!-- jQuery library -->
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

			<!-- Popper JS -->
			<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

			<!-- Latest compiled JavaScript -->
			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		   
			<style>
			  body {
			      position: relative; 
			  }
			 </style>
		    
		    
    </head>

    <body data-spy="scroll" data-target=".navbar" data-offset="50">
    	<nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
    
	    	<!-- <h1 id = 'loading-label'>Loading available RTFD products</h1>
	    	<h1 id = 'title-label'>RTFD Products</h1>
	    	<hr> -->
	    	<ul class = 'navbar-nav'>
	    		<li><a href="#raw">RTFD Raw</a></li>
	    		<li><a href="#eight_bit_list">RTFD 8 Bit</a></li>
	    		<li><a href="#secpersistence_listtion1">RTFD Persistence</a></li>
		    	
	 		</ul>	

	 		<div id="raw" class="container-fluid bg-info" style="padding-top:70px;padding-bottom:70px">
  				<h1>RTFD Raw</h1>
  				<ul id = 'raw_list' class="list-group list-group-flush">RTFD Raw</ul>
			</div>
	 		<!-- <ul id = 'raw_list' class="list-group list-group-flush">RTFD Raw</ul>
	    	<hr>
	    	<ul id = 'eight_bit_list' class="list-group list-group-flush">RTFD 8 Bit</ul>
	    	<hr>
	    	<ul id = 'persistence_list' class="list-group list-group-flush">RTFD Persistence</ul> -->

	    <script type="text/javascript">
	    	$('#loading-label').show();
	    	$('#title-label').hide();
	    	function load_available_rtfd(){

		    	var bucketName = 'rtfd-delivery'
		    	var raw_tifs = [];
		    	var eight_bit_tifs = [];
		    	var persistence_tifs = [];
		    	$.ajax({
			        type: 'GET',
			        url: `https://storage.googleapis.com/storage/v1/b/${bucketName}/o`,
			    }).done(function(json){
			        json = json.items
			        json.map(function(item){
			        	// console.log(item)
			        	if(item.name.endsWith('_persistence.tif')){
			        		persistence_tifs.push(item)
			        	}else if(item.name.endsWith('_8bit.tif')){
			        		eight_bit_tifs.push(item)
			        	}else if(item.name.endsWith('.tif')){
			        		raw_tifs.push(item)
			        	}
			            // if(item.id.indexOf(id)>-1){
			            //     var link = document.createElement("a");
			            //     link.setAttribute("href", item.mediaLink);
			            //     link.setAttribute("download", item.name);
			            //     link.style.visibility = 'hidden';
			            //     document.body.appendChild(link);
			            //     link.click();
			            //     sleep(1000);
			            //     document.body.removeChild(link);
			            //     sleep(1000);
			            // }

			            
			        })
			        console.log(persistence_tifs)
			        persistence_tifs.map(function(p){
			        	$('#persistence_list').append(`<li class="list-group-item"><a href = '${p.mediaLink}'>${p.name}</a></li>`)
			        })
			        eight_bit_tifs.map(function(p){
			        	$('#eight_bit_list').append(`<li class="list-group-item"><a href = '${p.mediaLink}'>${p.name}</a></li>`)
			        })
			        raw_tifs.map(function(p){
			        	$('#raw_list').append(`<li class="list-group-item"><a href = '${p.mediaLink}'>${p.name}</a></li>`)
			        })
			        })
			    	$('#loading-label').hide();
			    	$('#title-label').show()
			    }
			    $(document).ready(function(){
			    	load_available_rtfd()
			    })

		    </script>
    	
    </body>
</html>